# sidepanel.js ëª¨ë“ˆí™” ë¦¬íŒ©í† ë§ í”Œëœ

## ğŸ“Š í˜„í™©
- **íŒŒì¼**: sidepanel.js (2,404ì¤„, 75KB)
- **ëª©í‘œ**: 7ê°œ ëª¨ë“ˆë¡œ ë¶„ë¦¬ (state, ui-utils, history, settings, translation, search + main)
- **ê·œê²©**: Chrome Extension Manifest V3, ES6 Module ì‚¬ìš©

---

## ğŸ¯ ìµœì¢… êµ¬ì¡°

chrome_ext_yt_ai/ â”œâ”€â”€ manifest.json # ìˆ˜ì • ë¶ˆí•„ìš” â”œâ”€â”€ sidepanel.html # ìˆ˜ì • ë¶ˆí•„ìš” (ì´ë¯¸ type="module") â”œâ”€â”€ sidepanel.js # ë©”ì¸ ì§„ì…ì  (~150ì¤„) â”œâ”€â”€ logger.js # ê¸°ì¡´ ìœ ì§€ â”œâ”€â”€ meta.js # ê¸°ì¡´ ìœ ì§€ â””â”€â”€ modules/ # ìƒˆë¡œ ìƒì„± â”œâ”€â”€ state.js # ìƒíƒœ ê´€ë¦¬ (~100ì¤„) â”œâ”€â”€ ui-utils.js # UI ìœ í‹¸ (~350ì¤„) â”œâ”€â”€ history.js # íˆìŠ¤í† ë¦¬ (~450ì¤„) â”œâ”€â”€ settings.js # ì„¤ì • (~450ì¤„) â”œâ”€â”€ translation.js # ë²ˆì—­ (~650ì¤„) â””â”€â”€ search.js # ê²€ìƒ‰ (~310ì¤„)


---

## ğŸ”§ Phase 1: ë°±ì—… ë° ì¤€ë¹„

### 1.1 ë°±ì—…
```bash
git add .
git commit -m "ğŸ’¾ Backup before refactoring sidepanel.js"
1.2 modules í´ë” ìƒì„±
mkdir -p modules
ğŸ“¦ Phase 2: ëª¨ë“ˆ ìƒì„± (ìˆœì„œ ì¤‘ìš”!)
2.1 modules/state.js ìƒì„±
ì‘ì—…:

modules/state.js íŒŒì¼ ìƒì„±
sidepanel.jsì—ì„œ ì•„ë˜ ì½”ë“œ ì´ë™ (ì¤„ 65-111):
ì „ì—­ ìƒíƒœ ë³€ìˆ˜ë“¤ (currentTabId, port, permissionGranted, translationState ë“±)
translationStateByTab, translateModeByTab Map
createDefaultTranslationState() í•¨ìˆ˜
modules/state.js ë‚´ìš©:

/**
 * ì „ì—­ ìƒíƒœ ê´€ë¦¬
 */

// ìƒíƒœ ë³€ìˆ˜ë“¤
export let currentTabId = null;
export let port = null;
export let permissionGranted = false;
export let settingsChanged = false;
export let originalSettings = {};
export let lastTranslateMode = 'cache';
export let lastHistoryCompletionMeta = { signature: null, ts: 0 };

export const translateModeByTab = new Map();
export const translationStateByTab = new Map();

export let translationState = {
  state: 'inactive',
  totalTexts: 0,
  translatedCount: 0,
  cachedCount: 0,
  batchCount: 0,
  batchesDone: 0,
  batches: [],
  activeMs: 0,
  originalTitle: '',
  translatedTitle: '',
  previewText: ''
};

// Setter í•¨ìˆ˜ë“¤
export function setCurrentTabId(tabId) {
  currentTabId = tabId;
}

export function setPort(newPort) {
  port = newPort;
}

export function setPermissionGranted(value) {
  permissionGranted = value;
}

export function setSettingsChanged(value) {
  settingsChanged = value;
}

export function setOriginalSettings(settings) {
  originalSettings = settings;
}

export function setLastTranslateMode(mode) {
  lastTranslateMode = mode;
}

export function setLastHistoryCompletionMeta(meta) {
  lastHistoryCompletionMeta = meta;
}

export function setTranslationState(newState) {
  translationState = newState;
}

export function createDefaultTranslationState() {
  return {
    state: 'inactive',
    totalTexts: 0,
    translatedCount: 0,
    cachedCount: 0,
    batchCount: 0,
    batchesDone: 0,
    batches: [],
    activeMs: 0,
    originalTitle: '',
    translatedTitle: '',
    previewText: ''
  };
}
sidepanel.js ìˆ˜ì •:

ì¤„ 65-111 ì‚­ì œ
íŒŒì¼ ìµœìƒë‹¨ì— ì¶”ê°€:
import * as State from './modules/state.js';
ì½”ë“œ ë‚´ ì‚¬ìš©ì²˜:
currentTabId â†’ State.currentTabId
translationState â†’ State.translationState
(ë˜ëŠ” ê°œë³„ import: import { currentTabId, translationState } from './modules/state.js';)
í…ŒìŠ¤íŠ¸:

# Chromeì—ì„œ í™•ì¥ ë¦¬ë¡œë“œ
# F12 ì½˜ì†”ì—ì„œ ì—ëŸ¬ í™•ì¸
# ì‚¬ì´ë“œíŒ¨ë„ ì—´ì–´ì„œ ì •ìƒ ì‘ë™ í™•ì¸
2.2 modules/ui-utils.js ìƒì„±
ì‘ì—…:

modules/ui-utils.js íŒŒì¼ ìƒì„±
sidepanel.jsì—ì„œ ì•„ë˜ í•¨ìˆ˜ë“¤ ì´ë™:
íƒ­ë°” ê´€ë¦¬ (ì¤„ 210-391): initTabbar, initExternalLinks, handleTabKeydown, switchTab, restoreSession, handleDeepLink
UI ì—…ë°ì´íŠ¸ (ì¤„ 1840-2020): updateUI, resetTranslateUI, getBatchStatusText, formatTime
ê°œë°œì ë„êµ¬ (ì¤„ 2021-2105): updateErrorLogCount, handleCopyLogs
showToast, ensurePageContentScript ë“± ê³µí†µ ìœ í‹¸
modules/ui-utils.js êµ¬ì¡°:

import { logInfo, logDebug } from '../logger.js';
import { currentTabId, translationState, permissionGranted, setTranslationState } from './state.js';

// SESSION_KEY ìƒìˆ˜ë„ ì—¬ê¸°ë¡œ ì´ë™
const SESSION_KEY = 'lastActiveTab';

export function initTabbar() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function switchTab(tabName) {
  // ê¸°ì¡´ ì½”ë“œ
}

export function showToast(message, type = 'success') {
  // ê¸°ì¡´ ì½”ë“œ
}

export function updateUI(hasPermission = true) {
  // ê¸°ì¡´ ì½”ë“œ
}

export function resetTranslateUI() {
  // ê¸°ì¡´ ì½”ë“œ
}

export function getBatchStatusText(status) {
  // ê¸°ì¡´ ì½”ë“œ
}

export function formatTime(seconds) {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function updateErrorLogCount() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function handleCopyLogs(mode = 'all') {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function restoreSession() {
  // ê¸°ì¡´ ì½”ë“œ
}

export function handleDeepLink() {
  // ê¸°ì¡´ ì½”ë“œ
}

export function initExternalLinks() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function ensurePageContentScript(tabId) {
  // ê¸°ì¡´ ì½”ë“œ
}
sidepanel.js ìˆ˜ì •:

í•´ë‹¹ í•¨ìˆ˜ë“¤ ì‚­ì œ
import ì¶”ê°€:
import { 
  initTabbar, 
  switchTab, 
  showToast, 
  updateUI,
  restoreSession,
  handleDeepLink,
  initExternalLinks
} from './modules/ui-utils.js';
í…ŒìŠ¤íŠ¸:

# íƒ­ ì „í™˜ í…ŒìŠ¤íŠ¸
# í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸
2.3 modules/search.js ìƒì„±
ì‘ì—…:

modules/search.js íŒŒì¼ ìƒì„±
sidepanel.jsì—ì„œ ê²€ìƒ‰ íƒ­ ê¸°ëŠ¥ ì´ë™ (ì¤„ 2106-2404):
ëª¨ë“  ì•„ì´ì½˜ í•¨ìˆ˜ë“¤
initializeSearchTab
handleGetRecommendations
callOpenRouterSearch
renderSearchRecommendations
openSearchResults
openAllSearchEngines
modules/search.js êµ¬ì¡°:

import { logInfo, logError } from '../logger.js';
import { showToast } from './ui-utils.js';

export function getGoogleIcon() {
  return `<img class="search-engine-icon" alt="Google" width="24" height="24" src="https://www.google.com/s2/favicons?sz=128&domain=google.com" style="width: 20px; height: 20px;">`;
}

export function getNaverIcon() {
  // ê¸°ì¡´ ì½”ë“œ
}

// ... ë‚˜ë¨¸ì§€ ì•„ì´ì½˜ í•¨ìˆ˜ë“¤

export function initializeSearchTab() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function handleGetRecommendations() {
  // ê¸°ì¡´ ì½”ë“œ
}

async function callOpenRouterSearch(query, apiKey) {
  // ê¸°ì¡´ ì½”ë“œ
}

export function renderSearchRecommendations(newRecommendations) {
  // ê¸°ì¡´ ì½”ë“œ
}

export function resetSearchRecommendations() {
  // ê¸°ì¡´ ì½”ë“œ
}

export function openSearchResults(engine, query) {
  // ê¸°ì¡´ ì½”ë“œ
}

export function openAllSearchEngines(query) {
  // ê¸°ì¡´ ì½”ë“œ
}
sidepanel.js ìˆ˜ì •:

import { initializeSearchTab } from './modules/search.js';
í…ŒìŠ¤íŠ¸:

# ê²€ìƒ‰ íƒ­ìœ¼ë¡œ ì´ë™
# AI ì¶”ì²œ ë°›ê¸° í´ë¦­
# ê²€ìƒ‰ ì—”ì§„ ì—´ê¸° í…ŒìŠ¤íŠ¸
2.4 modules/settings.js ìƒì„±
ì‘ì—…:

modules/settings.js íŒŒì¼ ìƒì„±
sidepanel.jsì—ì„œ ì„¤ì • ê´€ë ¨ í•¨ìˆ˜ ì´ë™:
API Key UI (ì¤„ 392-419): updateApiKeyUI
ì„¤ì • ê´€ë¦¬ (ì¤„ 856-1237): initSettingsTab, loadSettings, handleSaveSettings, showSaveBar, hideSaveBar
ìºì‹œ ê´€ë¦¬: getPageCacheStatus, updatePageCacheStatus, handleClearPageCache, formatBytes
modules/settings.js êµ¬ì¡°:

import { logInfo, logError, initLogger } from '../logger.js';
import { currentTabId, setSettingsChanged, setOriginalSettings } from './state.js';
import { showToast, ensurePageContentScript } from './ui-utils.js';

// ìƒìˆ˜ë“¤
const DEFAULT_CACHE_TTL_MINUTES = 43200;
const CACHE_TTL_MIN_MINUTES = 5;
const CACHE_TTL_MAX_MINUTES = 525600;

export async function updateApiKeyUI() {
  // ê¸°ì¡´ ì½”ë“œ
}

export function initSettingsTab() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function loadSettings() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function handleSaveSettings() {
  // ê¸°ì¡´ ì½”ë“œ
}

export function showSaveBar() {
  // ê¸°ì¡´ ì½”ë“œ
}

export function hideSaveBar() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function getPageCacheStatus() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function updatePageCacheStatus() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function handleClearPageCache() {
  // ê¸°ì¡´ ì½”ë“œ
}

function formatBytes(bytes) {
  // ê¸°ì¡´ ì½”ë“œ
}
sidepanel.js ìˆ˜ì •:

import { 
  initSettingsTab, 
  loadSettings, 
  updateApiKeyUI, 
  updatePageCacheStatus 
} from './modules/settings.js';
í…ŒìŠ¤íŠ¸:

# ì„¤ì • íƒ­ì—ì„œ API Key ì…ë ¥
# ì €ì¥ ë²„íŠ¼ í´ë¦­
# ìºì‹œ ì •ë³´ í‘œì‹œ í™•ì¸
2.5 modules/history.js ìƒì„±
ì‘ì—…:

modules/history.js íŒŒì¼ ìƒì„±
sidepanel.jsì—ì„œ íˆìŠ¤í† ë¦¬ ê´€ë ¨ í•¨ìˆ˜ ì´ë™ (ì¤„ 420-855):
deduplicateHistoryByUrl (ì¤„ 39-63ë„ í•¨ê»˜)
initHistoryTab
renderHistoryList
loadHistoryEntries
createHistoryItemElement
saveHistoryEntry
deleteHistoryEntry
clearHistory
handleHistoryItemOpen
waitForTabLoad
formatHistoryTime
formatHistoryMode
handleTranslationCompletedForHistory
modules/history.js êµ¬ì¡°:

import { logInfo, logWarn, logError } from '../logger.js';
import { currentTabId, lastHistoryCompletionMeta, setLastHistoryCompletionMeta } from './state.js';
import { showToast, switchTab } from './ui-utils.js';

// ìƒìˆ˜
const HISTORY_STORAGE_KEY = 'translationHistory';
const HISTORY_MAX_ITEMS = 100;

export function deduplicateHistoryByUrl(entries) {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function initHistoryTab() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function renderHistoryList(prefetchedEntries) {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function loadHistoryEntries() {
  // ê¸°ì¡´ ì½”ë“œ
}

function createHistoryItemElement(entry) {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function saveHistoryEntry(entry) {
  // ê¸°ì¡´ ì½”ë“œ
}

async function deleteHistoryEntry(entryId) {
  // ê¸°ì¡´ ì½”ë“œ
}

async function clearHistory() {
  // ê¸°ì¡´ ì½”ë“œ
}

function isHistoryTabActive() {
  // ê¸°ì¡´ ì½”ë“œ
}

async function handleHistoryItemOpen(entry) {
  // ê¸°ì¡´ ì½”ë“œ - ì—¬ê¸°ì„œ handleTranslateAll í˜¸ì¶œí•˜ëŠ”ë° ìˆœí™˜ ì˜ì¡´ì„± ì£¼ì˜!
}

function waitForTabLoad(tabId, timeoutMs = 20000) {
  // ê¸°ì¡´ ì½”ë“œ
}

function formatHistoryTime(isoString) {
  // ê¸°ì¡´ ì½”ë“œ
}

function formatHistoryMode(mode) {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function handleTranslationCompletedForHistory(tabId, data) {
  // ê¸°ì¡´ ì½”ë“œ
}
âš ï¸ ìˆœí™˜ ì˜ì¡´ì„± ì£¼ì˜:

handleHistoryItemOpenì—ì„œ handleTranslateAll í˜¸ì¶œ
translation.jsì—ì„œ handleTranslationCompletedForHistory í˜¸ì¶œ
í•´ê²°: history.jsì—ì„œ translation.jsë¥¼ importí•˜ë˜, translation.jsëŠ” historyë¥¼ ì§ì ‘ import ì•ˆ í•¨
sidepanel.js ìˆ˜ì •:

import { 
  initHistoryTab, 
  handleTranslationCompletedForHistory 
} from './modules/history.js';
í…ŒìŠ¤íŠ¸:

# íˆìŠ¤í† ë¦¬ íƒ­ ë Œë”ë§
# í•­ëª© í´ë¦­ ì‹œ ì¬ë²ˆì—­
# ì‚­ì œ ê¸°ëŠ¥
2.6 modules/translation.js ìƒì„± â­ (ê°€ì¥ ë³µì¡)
ì‘ì—…:

modules/translation.js íŒŒì¼ ìƒì„±
sidepanel.jsì—ì„œ ë²ˆì—­ ê¸°ëŠ¥ ì´ë™ (ì¤„ 1238-1839):
getSupportType
initializeTranslationState
handleTabChange
queryTranslationState
updateUIByPermission
checkPermissions
handleRequestPermission
ensureContentScriptReady
connectToContentScript
handleTranslateAll
handleRestore
handleResetTranslate
modules/translation.js êµ¬ì¡°:

import { logInfo, logWarn, logError, logDebug } from '../logger.js';
import { 
  currentTabId,
  port,
  translationState,
  translationStateByTab,
  translateModeByTab,
  setCurrentTabId,
  setPort,
  setPermissionGranted,
  setTranslationState,
  createDefaultTranslationState
} from './state.js';
import { updateUI, resetTranslateUI, showToast } from './ui-utils.js';
import { handleTranslationCompletedForHistory } from './history.js';

export function getSupportType(url) {
  // ê¸°ì¡´ ì½”ë“œ
}

export function initializeTranslationState() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function handleTabChange(tab) {
  // ê¸°ì¡´ ì½”ë“œ - í•µì‹¬ ë¡œì§!
}

async function queryTranslationState(tab) {
  // ê¸°ì¡´ ì½”ë“œ
}

function updateUIByPermission() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function checkPermissions(tab) {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function handleRequestPermission() {
  // ê¸°ì¡´ ì½”ë“œ
}

async function ensureContentScriptReady(tabId, maxRetries = 5) {
  // ê¸°ì¡´ ì½”ë“œ
}

function connectToContentScript(tabId) {
  // ê¸°ì¡´ ì½”ë“œ - Port í†µì‹ !
}

export async function handleTranslateAll(useCache = true) {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function handleRestore() {
  // ê¸°ì¡´ ì½”ë“œ
}

export async function handleResetTranslate() {
  // ê¸°ì¡´ ì½”ë“œ
}
sidepanel.js ìˆ˜ì •:

import { 
  handleTabChange, 
  handleTranslateAll, 
  handleRestore,
  handleResetTranslate,
  checkPermissions
} from './modules/translation.js';
í…ŒìŠ¤íŠ¸:

# ë²ˆì—­ ë²„íŠ¼ í´ë¦­
# ì§„í–‰ë¥  í‘œì‹œ í™•ì¸
# ì›ë³¸ ë³µì› ë²„íŠ¼
# ë²ˆì—­ ì¤‘ íƒ­ ì „í™˜ ë°©ì§€ í…ŒìŠ¤íŠ¸
ğŸ“ Phase 3: ë©”ì¸ íŒŒì¼ ì •ë¦¬
3.1 sidepanel.js ìŠ¬ë¦¼í™”
ìµœì¢… sidepanel.js êµ¬ì¡°:

/**
 * Side Panel Script - ë©”ì¸ ì§„ì…ì 
 */

import { FOOTER_TEXT } from './meta.js';
import { log, logInfo, logWarn, logError, logDebug, getLogs, initLogger } from './logger.js';

// ëª¨ë“ˆ import
import * as State from './modules/state.js';
import { 
  initTabbar, 
  switchTab, 
  restoreSession, 
  handleDeepLink, 
  initExternalLinks,
  updateUI 
} from './modules/ui-utils.js';
import { initHistoryTab } from './modules/history.js';
import { 
  initSettingsTab, 
  loadSettings, 
  updateApiKeyUI, 
  updatePageCacheStatus 
} from './modules/settings.js';
import { 
  handleTabChange, 
  handleTranslateAll, 
  handleRestore, 
  handleResetTranslate 
} from './modules/translation.js';
import { initializeSearchTab } from './modules/search.js';

// ìƒìˆ˜ ì •ì˜
const DEFAULT_MODEL = 'openai/gpt-4o-mini';
const GITHUB_REPO_URL = 'https://github.com/park-youngtack/chrome_ext_yt_ai';

// DOMContentLoaded
document.addEventListener('DOMContentLoaded', async () => {
  try {
    // ë¡œê±° ì´ˆê¸°í™”
    await initLogger();
    
    // í‘¸í„° ì„¤ì •
    const footerEl = document.getElementById('footerText');
    if (footerEl) {
      footerEl.textContent = FOOTER_TEXT;
    }

    // íƒ­ë°” ì´ˆê¸°í™”
    initTabbar();
    initExternalLinks();

    // ì™¸ë¶€ ë§í¬ (GitHub)
    const githubBtn = document.getElementById('githubLinkBtn');
    if (githubBtn) {
      githubBtn.addEventListener('click', () => {
        chrome.tabs.create({ url: GITHUB_REPO_URL });
      });
    }

    // ì„¤ì • íƒ­ ì´ˆê¸°í™”
    initSettingsTab();
    await loadSettings();

    // íˆìŠ¤í† ë¦¬ íƒ­ ì´ˆê¸°í™”
    await initHistoryTab();

    // ê²€ìƒ‰ íƒ­ ì´ˆê¸°í™”
    initializeSearchTab();

    // í˜„ì¬ íƒ­ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });
    if (tab) {
      State.setCurrentTabId(tab.id);
      await handleTabChange(tab);
    }

    // ì„¸ì…˜ ë³µì›
    await restoreSession();

    // ë”¥ë§í¬ ì²˜ë¦¬
    handleDeepLink();

    logInfo('sidepanel', 'INIT', 'ì‚¬ì´ë“œíŒ¨ë„ ì´ˆê¸°í™” ì™„ë£Œ');
  } catch (error) {
    logError('sidepanel', 'INIT_ERROR', 'ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜', { error: error.message });
  }
});

// Chrome íƒ­ ë¦¬ìŠ¤ë„ˆ
chrome.tabs.onActivated.addListener(async (activeInfo) => {
  try {
    const tab = await chrome.tabs.get(activeInfo.tabId);
    await handleTabChange(tab);
  } catch (error) {
    logError('sidepanel', 'TAB_ACTIVATED_ERROR', 'íƒ­ í™œì„±í™” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜', { error: error.message });
  }
});

chrome.tabs.onUpdated.addListener(async (tabId, changeInfo, tab) => {
  if (State.currentTabId === tabId && changeInfo.status === 'complete') {
    await handleTabChange(tab);
    await updatePageCacheStatus();
  }
});
ë³€ê²½ì‚¬í•­:

ëª¨ë“  í•¨ìˆ˜ ì •ì˜ ì œê±° (ëª¨ë“ˆë¡œ ì´ë™)
import ë¬¸ë§Œ ìœ ì§€
ì´ˆê¸°í™” ë¡œì§ ë‹¨ìˆœí™”
ì „ì—­ ìƒíƒœëŠ” State ëª¨ë“ˆì„ í†µí•´ ì ‘ê·¼
í…ŒìŠ¤íŠ¸:

# ì „ì²´ ê¸°ëŠ¥ í†µí•© í…ŒìŠ¤íŠ¸
# ì½˜ì†” ì—ëŸ¬ 0ê±´ í™•ì¸
âœ… Phase 4: ê²€ì¦
4.1 ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
# ì²´í¬ë¦¬ìŠ¤íŠ¸
â–¡ ë²ˆì—­ íƒ­: ìºì‹œ ìš°ì„  ë²ˆì—­
â–¡ ë²ˆì—­ íƒ­: ì „ë©´ ì¬ë²ˆì—­
â–¡ ë²ˆì—­ íƒ­: ì›ë³¸ ë³µì›
â–¡ ë²ˆì—­ íƒ­: ë²ˆì—­ ìƒíƒœ ì´ˆê¸°í™”
â–¡ íˆìŠ¤í† ë¦¬ íƒ­: ëª©ë¡ í‘œì‹œ
â–¡ íˆìŠ¤í† ë¦¬ íƒ­: í•­ëª© í´ë¦­ ì¬ë²ˆì—­
â–¡ íˆìŠ¤í† ë¦¬ íƒ­: ì‚­ì œ
â–¡ ê²€ìƒ‰ íƒ­: AI ì¶”ì²œ
â–¡ ê²€ìƒ‰ íƒ­: ê²€ìƒ‰ ì—”ì§„ ì—´ê¸°
â–¡ ì„¤ì • íƒ­: API Key ì €ì¥
â–¡ ì„¤ì • íƒ­: ì„¤ì • ë³€ê²½ ì €ì¥
â–¡ íƒ­ ì „í™˜: ì •ìƒ ë™ì‘
â–¡ ë²ˆì—­ ì¤‘ íƒ­ ì „í™˜: ë°©ì§€ í™•ì¸
â–¡ ê¶Œí•œ: file:// URL ê¶Œí•œ ìš”ì²­
â–¡ ì½˜ì†”: ì—ëŸ¬ 0ê±´
4.2 ìˆœí™˜ ì˜ì¡´ì„± ì²´í¬
# madge ì„¤ì¹˜ (ì„ íƒì‚¬í•­)
npm install -g madge

# ìˆœí™˜ ì˜ì¡´ì„± í™•ì¸
madge --circular --extensions js modules/ sidepanel.js

# ìˆœí™˜ ì˜ì¡´ì„± ë°œê²¬ ì‹œ
# â†’ ê³µí†µ í•¨ìˆ˜ë¥¼ ë³„ë„ íŒŒì¼ë¡œ ë¶„ë¦¬ (ì˜ˆ: modules/common.js)
4.3 ì½”ë“œ í’ˆì§ˆ
# ì¤„ ìˆ˜ í™•ì¸
wc -l sidepanel.js modules/*.js

# ì˜ˆìƒ ê²°ê³¼:
#   150 sidepanel.js
#   100 modules/state.js
#   350 modules/ui-utils.js
#   450 modules/history.js
#   450 modules/settings.js
#   650 modules/translation.js
#   310 modules/search.js
ğŸ“š Phase 5: ë¬¸ì„œ ì—…ë°ì´íŠ¸
5.1 CLAUDE.md ì—…ë°ì´íŠ¸
íŒŒì¼ êµ¬ì¡° ì„¹ì…˜ ìˆ˜ì •:

## íŒŒì¼ êµ¬ì¡°

chrome_ext_yt_ai/
â”œâ”€â”€ manifest.json              # Chrome í™•ì¥ ë©”íƒ€ë°ì´í„°
â”œâ”€â”€ background.js              # Service Worker
â”œâ”€â”€ content.js                 # Content Script
â”œâ”€â”€ sidepanel.html             # ì‚¬ì´ë“œíŒ¨ë„ UI
â”œâ”€â”€ sidepanel.js               # ì‚¬ì´ë“œíŒ¨ë„ ë©”ì¸ ì§„ì…ì  (~150ì¤„)
â”œâ”€â”€ sidepanel.css              # íŒ¨ë„ ìŠ¤íƒ€ì¼
â”œâ”€â”€ logger.js                  # ê³µìš© ë¡œê¹… ì‹œìŠ¤í…œ
â”œâ”€â”€ meta.js                    # ë©”íƒ€ ì •ë³´
â”œâ”€â”€ modules/                   # ì‚¬ì´ë“œíŒ¨ë„ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ state.js              # ì „ì—­ ìƒíƒœ ê´€ë¦¬ (~100ì¤„)
â”‚   â”œâ”€â”€ ui-utils.js           # UI ìœ í‹¸ë¦¬í‹° (~350ì¤„)
â”‚   â”œâ”€â”€ history.js            # íˆìŠ¤í† ë¦¬ ê´€ë¦¬ (~450ì¤„)
â”‚   â”œâ”€â”€ settings.js           # ì„¤ì • ê´€ë¦¬ (~450ì¤„)
â”‚   â”œâ”€â”€ translation.js        # ë²ˆì—­ í•µì‹¬ ë¡œì§ (~650ì¤„)
â”‚   â””â”€â”€ search.js             # ê²€ìƒ‰ ê¸°ëŠ¥ (~310ì¤„)
â”œâ”€â”€ README.md                  # ì‚¬ìš©ì ê°€ì´ë“œ
â”œâ”€â”€ CLAUDE.md                  # ê°œë°œ ê°€ì´ë“œ
â””â”€â”€ icons/                     # í™•ì¥ ì•„ì´ì½˜
ëª¨ë“ˆ ì„¤ëª… ì¶”ê°€:

### modules/ ë””ë ‰í† ë¦¬

#### state.js
- ì „ì—­ ìƒíƒœ ë³€ìˆ˜ ê´€ë¦¬
- currentTabId, port, translationState ë“±
- Setter/Getter í•¨ìˆ˜ ì œê³µ

#### ui-utils.js
- íƒ­ ì „í™˜ (switchTab)
- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ (showToast)
- UI ì—…ë°ì´íŠ¸ (updateUI)
- í¬ë§· í•¨ìˆ˜ (formatTime, getBatchStatusText)

#### history.js
- íˆìŠ¤í† ë¦¬ CRUD
- ë²ˆì—­ ì™„ë£Œ ì‹œ ìë™ ì €ì¥
- URLë³„ ì¤‘ë³µ ì œê±°

#### settings.js
- ì„¤ì • ë¡œë“œ/ì €ì¥
- API Key ê´€ë¦¬
- ìºì‹œ ìƒíƒœ í‘œì‹œ

#### translation.js
- ë²ˆì—­ ì‹¤í–‰ (handleTranslateAll)
- ê¶Œí•œ ì²´í¬ (checkPermissions)
- Content Script í†µì‹  (Port)
- íƒ­ë³„ ìƒíƒœ ê´€ë¦¬

#### search.js
- AI ê²€ìƒ‰ ì¶”ì²œ
- ê²€ìƒ‰ ì—”ì§„ ì—´ê¸°
- OpenRouter API í˜¸ì¶œ
5.2 meta.js ì—…ë°ì´íŠ¸
// meta.js
export const VERSION = '2.2.0';
export const LAST_EDITED = '2025-11-10';  // ì˜¤ëŠ˜ ë‚ ì§œë¡œ
export const FOOTER_TEXT = `ì¸í¬ë¡œìŠ¤ AIë¹„ì¦ˆì†”ë£¨ì…˜íŒ€ ë°•ì˜íƒ Â· ìµœì¢… ìˆ˜ì •: ${LAST_EDITED}`;
ğŸš€ Phase 6: ì»¤ë°‹ ë° í‘¸ì‹œ
6.1 ì»¤ë°‹
git add modules/ sidepanel.js CLAUDE.md meta.js
git commit -m "â™»ï¸ Refactor sidepanel.js into 6 modules

- Split 2,404-line file into manageable modules
- Create modules/ directory with:
  - state.js: Global state management (~100 lines)
  - ui-utils.js: UI utilities (~350 lines)
  - history.js: History CRUD (~450 lines)
  - settings.js: Settings management (~450 lines)
  - translation.js: Translation core (~650 lines)
  - search.js: Search functionality (~310 lines)
- Keep sidepanel.js as main entry point (~150 lines)
- Update CLAUDE.md with new file structure
- All features tested and working
- Zero console errors
- Chrome Extension Manifest V3 compliant
"
6.2 í‘¸ì‹œ
git push -u origin claude/refactor-sidepanel-analysis-011CV142SzjPkHwDZA2D2MNb
âš ï¸ ì£¼ì˜ì‚¬í•­
Import ê²½ë¡œ
// âœ… ì˜¬ë°”ë¥¸ ê²½ë¡œ
import { log } from './logger.js';              // ê°™ì€ ë ˆë²¨
import { state } from './modules/state.js';     // í•˜ìœ„ í´ë”
import { log } from '../logger.js';             // ìƒìœ„ í´ë” (modules ë‚´ë¶€ì—ì„œ)

// âŒ ì˜ëª»ëœ ê²½ë¡œ
import { log } from '/logger.js';               // ì ˆëŒ€ ê²½ë¡œ X
import { log } from 'logger.js';                // ìƒëŒ€ í‘œì‹œ ì—†ìŒ X
ìˆœí™˜ ì˜ì¡´ì„± ë°©ì§€
// âŒ ìˆœí™˜ ì˜ì¡´ì„± ë°œìƒ
// history.js â†’ translation.js â†’ history.js

// âœ… í•´ê²° ë°©ë²• 1: í•œìª½ë§Œ import
// history.js â†’ translation.js (O)
// translation.js â†’ history.js (X, ëŒ€ì‹  ì½œë°± ì „ë‹¬)

// âœ… í•´ê²° ë°©ë²• 2: ê³µí†µ í•¨ìˆ˜ ë¶„ë¦¬
// history.js â†’ common.js
// translation.js â†’ common.js
Chrome Extension ë””ë²„ê¹…
# 1. í™•ì¥ ë¦¬ë¡œë“œ
chrome://extensions/ â†’ "ìƒˆë¡œê³ ì¹¨" í´ë¦­

# 2. ì½˜ì†” í™•ì¸
ì‚¬ì´ë“œíŒ¨ë„ì—ì„œ F12 â†’ Console íƒ­

# 3. Import ì—ëŸ¬
"Cannot use import statement outside a module"
â†’ HTMLì—ì„œ <script type="module"> í™•ì¸

# 4. íŒŒì¼ ë¡œë”© ì‹¤íŒ¨
"GET chrome-extension://xxx/modules/history.js net::ERR_FILE_NOT_FOUND"
â†’ íŒŒì¼ ê²½ë¡œ ë° ì¡´ì¬ ì—¬ë¶€ í™•ì¸
ê° Phase ì™„ë£Œ ì‹œ
# ì¦‰ì‹œ í…ŒìŠ¤íŠ¸!
# ë¬¸ì œ ë°œê²¬ ì‹œ ë°”ë¡œ ìˆ˜ì •!
# ë‹¤ìŒ Phaseë¡œ ë„˜ì–´ê°€ê¸° ì „ ì»¤ë°‹!

git add .
git commit -m "âœ… Phase 2.X completed"
ğŸ“Š ì˜ˆìƒ ê²°ê³¼
Before
sidepanel.js: 2,404ì¤„ (75KB)
ê°€ë…ì„±: â­â­
ìœ ì§€ë³´ìˆ˜: â­â­
After
sidepanel.js: ~150ì¤„ (ë©”ì¸)
6ê°œ ëª¨ë“ˆ: 100-650ì¤„ì”©
ê°€ë…ì„±: â­â­â­â­â­
ìœ ì§€ë³´ìˆ˜: â­â­â­â­â­
í˜‘ì—… ì¶©ëŒ: ìµœì†Œí™”
í…ŒìŠ¤íŠ¸: ëª¨ë“ˆë³„ ë…ë¦½ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
ğŸ‰ ì™„ë£Œ ê¸°ì¤€

ëª¨ë“  ëª¨ë“ˆ íŒŒì¼ ìƒì„± ì™„ë£Œ

sidepanel.js 150ì¤„ ì´í•˜ë¡œ ìŠ¬ë¦¼í™”

ì „ì²´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ í†µê³¼

ì½˜ì†” ì—ëŸ¬ 0ê±´

ìˆœí™˜ ì˜ì¡´ì„± ì—†ìŒ

CLAUDE.md ì—…ë°ì´íŠ¸

Git ì»¤ë°‹ & í‘¸ì‹œ ì™„ë£Œ
ğŸ†˜ ë¬¸ì œ í•´ê²°
Q: Import ì—ëŸ¬ ë°œìƒ
A: íŒŒì¼ ê²½ë¡œ í™•ì¸, .js í™•ì¥ì í¬í•¨ í™•ì¸

Q: ìˆœí™˜ ì˜ì¡´ì„± ë°œê²¬
A: madgeë¡œ í™•ì¸ í›„ ê³µí†µ í•¨ìˆ˜ ë¶„ë¦¬

Q: íŠ¹ì • í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
A: export í‚¤ì›Œë“œ ì¶”ê°€ í™•ì¸, import ë¬¸ í™•ì¸

Q: Stateê°€ undefined
A: Setter í•¨ìˆ˜ ì‚¬ìš© í™•ì¸, let ë³€ìˆ˜ ì§ì ‘ ìˆ˜ì • ê¸ˆì§€

ë! ì´ì œ Phase 1ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰í•˜ì„¸ìš”.