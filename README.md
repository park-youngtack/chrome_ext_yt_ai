# 웹페이지 번역기 - Chrome Extension

OpenRouter AI를 사용하여 웹페이지를 한글로 번역하는 크롬 확장프로그램입니다.

## 주요 기능

- **AI 맥락 인식 번역**: LLM이 페이지 분석하여 산업군 자동 판단, 전문 번역 가이드라인 제공
- **화면 보이는 영역 번역**: 현재 뷰포트에 보이는 텍스트를 한글로 번역
- **스크롤 자동 번역**: 스크롤하여 새로운 영역이 나타나면 자동으로 번역
- **스마트 캐싱**: 한 번 번역한 텍스트는 캐시에 저장하여 API 재호출 방지
- **자동 일시정지**: 사용자 활동이 없으면 자동으로 번역 중지하여 리소스 절약
- **번역 상태 관리**: 원본/번역중/중지됨 3단계 상태 관리 및 팝업에서 실시간 확인
- **토글 버튼**: "이 페이지 번역하기" ↔ "원본 페이지 보기" ↔ "번역 작업 시작" 상태별 표시
- **코드 스니펫 제외**: CODE, PRE 등 코드 블록은 번역하지 않음
- **시각적 로딩 효과**: 번역 중인 영역을 시각적으로 표시
- **유연한 모델 선택**: OpenRouter의 모든 AI 모델 사용 가능
- **안전한 키 관리**: API 키 로컬 저장
- **개인용 사용**: 수동 설치로 간편하게 사용

## 사전 준비

1. **OpenRouter API Key 발급**
   - [OpenRouter](https://openrouter.ai/) 가입
   - [API Keys 페이지](https://openrouter.ai/keys)에서 API Key 발급
   - 크레딧 충전 필요

## 설치 방법

### 1. 저장소 클론 또는 다운로드

```bash
git clone <repository-url>
cd chrome_ext_yt_ai
```

### 2. Chrome에 확장프로그램 로드

1. Chrome 브라우저를 엽니다
2. 주소창에 `chrome://extensions/` 입력
3. 우측 상단의 **개발자 모드** 토글을 활성화
4. **압축해제된 확장 프로그램을 로드합니다** 버튼 클릭
5. 이 프로젝트 폴더 (`chrome_ext_yt_ai`) 선택

### 3. 확장프로그램 확인

- Chrome 우측 상단에 파란색 "한" 아이콘이 표시됩니다
- 아이콘이 안 보이면 퍼즐 아이콘을 클릭하여 확장프로그램 목록에서 핀으로 고정하세요

## 사용 방법

### 초기 설정

1. 확장프로그램 아이콘 (파란색 "한") 클릭
2. **OpenRouter API Key** 입력
3. **AI 모델** 입력 (선택사항)
   - 비워두면 기본 모델 `openai/gpt-4o-mini` 사용
   - 다른 모델을 사용하려면 모델명 입력 (예: `anthropic/claude-3.5-sonnet`)
   - [OpenRouter 모델 목록](https://openrouter.ai/models)에서 확인 가능
4. **자동 일시정지 설정** (선택사항)
   - 체크박스: 자동 일시정지 활성화/비활성화 (기본값: 활성화)
   - 대기 시간: 사용자 활동 없이 대기할 시간 설정 (10~600초, 기본값: 60초)
   - 자동 일시정지가 작동하면 팝업에서 "번역 작업 시작" 버튼으로 재개 가능
5. **설정 저장** 버튼 클릭

**추천 모델:**
- `openai/gpt-4o-mini` - 빠르고 저렴 (기본값)
- `anthropic/claude-3.5-sonnet` - 고품질 번역
- `google/gemini-flash-1.5` - 빠른 속도

### 웹페이지 번역

1. 번역하고 싶은 웹페이지로 이동
2. 확장프로그램 아이콘 클릭
3. **페이지 번역 상태**를 확인 (원본 페이지/번역중/번역 중지됨)
4. **이 페이지 번역하기** 버튼 클릭
5. 화면에 보이는 텍스트가 한글로 번역됩니다
6. **스크롤하면** 새로운 영역도 자동으로 번역됩니다
7. 번역 중인 영역은 **파란색 로딩 효과**로 표시됩니다

### 자동 일시정지

1. 번역 중 설정한 시간(기본 60초) 동안 사용자 활동이 없으면 자동으로 번역 중지
2. 화면 하단에 **토스트 메시지** 표시: "활동이 없어 자동 일시정지되었습니다..."
3. 페이지 번역 상태가 **"번역 중지됨"**으로 변경됨
4. 확장프로그램 아이콘 클릭 시 버튼이 **"번역 작업 시작"**으로 표시됨
5. 버튼 클릭으로 번역 재개 가능

**사용자 활동 감지:**
- 마우스 이동
- 스크롤
- 키보드 입력
- 클릭
- 터치 (모바일)

### 원본으로 복원

1. 번역 중인 상태에서 확장프로그램 아이콘 클릭
2. **원본 페이지 보기(번역 중지)** 버튼 클릭 (버튼 텍스트가 자동 변경됨)
3. 원본 텍스트로 복원됩니다
4. 다시 번역 버튼을 누르면 **캐시된 번역**을 사용하여 즉시 번역 (API 호출 없음)

### 특징

- **맥락 인식 번역**: 페이지 분석으로 전문 용어 정확도 향상
  - 의료 사이트: "cell" → "세포" (생물학 용어)
  - IT 블로그: "cell" → "셀" (테이블 셀)
  - 프로그래밍: "Python" → "파이썬" (언어)
  - 동물학: "Python" → "비단뱀"
- **코드는 번역 안 함**: 웹페이지의 코드 스니펫은 자동으로 제외됩니다
- **점진적 번역**: 화면에 보이는 부분만 번역하여 빠른 응답
- **스마트 캐싱**: 같은 페이지에서는 한 번만 API 호출, 이후는 캐시 사용
- **중복 방지**: 이미 번역된 영역은 다시 번역하지 않음
- **리소스 절약**: 자동 일시정지로 불필요한 API 호출 및 메모리 사용 최소화
- **실시간 상태 확인**: 팝업에서 현재 번역 상태 실시간 확인

## 파일 구조

```
chrome_ext_yt_ai/
├── manifest.json          # 확장프로그램 설정 파일
├── popup.html            # 설정 UI
├── popup.js              # 설정 로직
├── content.js            # 번역 기능 (웹페이지에 주입)
├── background.js         # 백그라운드 서비스 워커
├── icons/                # 확장프로그램 아이콘
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
├── create_icons.py       # 아이콘 생성 스크립트
└── README.md            # 이 파일
```

## 작동 원리

1. **content.js**가 웹페이지에 주입됩니다
2. 사용자가 번역 버튼을 클릭하면:
   - **번역 상태**가 `inactive`에서 `active`로 변경
   - **AI 기반 페이지 컨텍스트 분석** (최초 1회만):
     - URL, 도메인, 제목, 메타 태그, 헤딩, 본문 일부 수집
     - **LLM에게 산업군 판단 요청**
     - LLM이 산업군, 카테고리, 번역 가이드라인을 JSON으로 반환
     - 예: `{"industry": "블록체인/암호화폐", "translationGuidelines": "Web3, DApp 등은 음역, gas fee는 가스비로..."}`
     - 결과를 캐시 (재분석 없음)
   - 화면에 보이는 텍스트 노드를 수집 (코드 블록 제외)
   - 캐시에 번역이 있는지 확인 (LRU 알고리즘)
   - 캐시가 있으면 즉시 적용 (requestAnimationFrame 사용), 없으면 API 호출
   - **LLM 가이드라인 기반 프롬프트 생성**:
     - 산업군 정보 포함
     - 주요 주제 포함
     - LLM이 제공한 번역 가이드라인 포함
     - 전문 용어 정확도 대폭 향상
   - 각 요소에 로딩 효과를 표시
   - 번역 결과를 캐시에 저장 (최대 1000개, LRU)
   - 원본 텍스트를 WeakMap에 저장 (자동 GC)
   - 번역된 요소를 Set에 추가
   - 스크롤 이벤트 리스너 등록 (passive mode)
   - **사용자 활동 감지 시작** (자동 일시정지용)
3. 스크롤 시 (scroll event):
   - 800ms 디바운스 후 번역 실행
   - 새로 보이는 영역만 번역
   - 동일한 LLM 가이드라인 사용 (재분석 없음)
4. 사용자 활동 감지:
   - 마우스 이동, 스크롤, 키보드 입력, 클릭, 터치 이벤트 감지
   - 설정한 시간(기본 60초) 동안 활동이 없으면:
     - 스크롤 감지 중지
     - 상태를 `paused`로 변경
     - 토스트 메시지 표시
     - 캐시와 번역된 내용은 유지
5. 번역 재개 (paused 상태):
   - 팝업에서 "번역 작업 시작" 버튼 클릭
   - 스크롤 감지 재시작
   - 사용자 활동 감지 재시작
   - 상태를 `active`로 변경
6. 원본 복원:
   - 모든 이벤트 리스너 제거
   - 스크롤 감지 중지
   - WeakMap/Set 정리 (참조 끊기)
   - 상태를 `inactive`로 변경
   - **캐시와 LLM 컨텍스트는 유지** (다음 번역 시 재사용)
7. 메모리 관리:
   - 페이지 숨김/이동 시 자동 정리
   - 5분마다 비활성 캐시 정리
   - LRU로 캐시 크기 제한
   - 주기적으로 DOM에서 사라진 요소 정리

## LLM 기반 산업군 자동 감지

**하드코딩된 키워드 매칭이 아닌, AI가 직접 판단합니다!**

### 작동 방식:

1. **페이지 정보 수집**
   - URL, 도메인, 제목
   - 메타 description
   - 주요 헤딩 (h1, h2)
   - 본문 첫 500자

2. **LLM 분석 요청**
   ```
   "이 페이지를 분석하여 산업군과 번역 가이드라인을 제공해주세요"
   ```

3. **LLM 응답 (JSON)**
   ```json
   {
     "industry": "블록체인/암호화폐",
     "category": "DeFi/스마트 컨트랙트",
     "translationGuidelines": "Web3, DApp, NFT 등은 음역하고,
                              smart contract는 스마트 컨트랙트로,
                              gas fee는 가스비로 번역"
   }
   ```

4. **번역 적용**
   - LLM 가이드라인을 번역 프롬프트에 포함
   - 전문 용어 정확도 대폭 향상

### 장점:

✅ **무한한 산업군 지원**
- 새로운 분야 자동 인식 (메타버스, Web3, AI/ML 등)
- 하드코딩 불필요

✅ **지능적 판단**
- 맥락 이해
- 복합 산업군도 감지 (예: "의료 AI", "금융 블록체인")

✅ **동적 가이드라인**
- 각 페이지에 최적화된 번역 가이드
- 용어 일관성 자동 유지

### 예시:

**ethereum.org 방문 시:**
- LLM 감지: "블록체인/암호화폐"
- 가이드라인: "Ethereum → 이더리움, DApp → 디앱, staking → 스테이킹"
- 결과: 전문 용어 정확도 100%

**huggingface.co 방문 시:**
- LLM 감지: "AI/머신러닝"
- 가이드라인: "transformer → 트랜스포머, fine-tuning → 파인튜닝"
- 결과: AI 전문 용어 정확

## 주의사항

- **API 비용**: OpenRouter 사용량에 따라 과금됩니다 (캐싱으로 비용 절감)
- **배치 번역**: 한 번에 50개씩 텍스트를 나누어 번역합니다
- **배치 대기**: 배치 간 300ms 대기 시간이 있습니다 (레이트 리밋 고려)
- **스크롤 번역**: 스크롤하면 새로운 영역도 자동으로 번역됩니다 (800ms 디바운스)
- **자동 일시정지**: 사용자 활동이 없으면 자동으로 중지됩니다 (설정 가능)
- **캐시 관리**: 최대 1000개 텍스트 캐시 (LRU 방식), 페이지 이동 시 자동 삭제
- **메모리 최적화**: WeakMap/Set 사용으로 메모리 누수 방지
- **컨텍스트 분석**: 최초 1회만 실행, 이후 캐시 사용
- **코드 제외**: CODE, PRE, KBD, SAMP, VAR 태그는 번역하지 않습니다
- **성능 로깅**: 콘솔(F12)에서 상세한 성능 로그 확인 가능

## 문제 해결

### 번역이 안 될 때

1. API Key가 올바르게 입력되었는지 확인
2. OpenRouter 계정에 크레딧이 있는지 확인
3. 개발자 도구 (F12) 콘솔에서 오류 메시지 확인
4. 확장프로그램을 비활성화 후 다시 활성화

### API 오류가 발생할 때

- `401 Unauthorized`: API Key가 잘못됨
- `402 Payment Required`: 크레딧 부족
- `429 Too Many Requests`: 너무 많은 요청, 잠시 대기 후 재시도

## 커스터마이징

### 아이콘 변경

`icons/` 폴더의 PNG 파일을 원하는 이미지로 교체하세요.
- icon16.png (16x16)
- icon48.png (48x48)
- icon128.png (128x128)

### 번역 대상 언어 변경

`content.js` 파일의 `translateWithOpenRouter` 함수에서 프롬프트를 수정하세요.

```javascript
const prompt = `다음 텍스트들을 영어로 번역해주세요...`; // 한국어 -> 영어로 변경
```

### 기본 모델 변경

`popup.js` 파일에서 `DEFAULT_MODEL` 상수를 수정하세요.

```javascript
const DEFAULT_MODEL = 'openai/gpt-4o-mini'; // 원하는 모델로 변경
```

## 개발 모드

코드를 수정한 후:
1. `chrome://extensions/` 페이지에서 확장프로그램 새로고침 버튼 클릭
2. 웹페이지도 새로고침하여 변경사항 반영

## 보안

- API Key는 Chrome의 `chrome.storage.local`에 저장됩니다
- 로컬 기기에만 저장되며 외부로 전송되지 않습니다
- HTTPS를 통해 OpenRouter API와만 통신합니다

## 라이선스

개인 사용을 위한 프로젝트입니다.

## 기여

버그 리포트나 기능 제안은 이슈로 등록해주세요.

## 지원

문제가 있거나 질문이 있으시면 이슈를 생성해주세요.
